# Extra tasks

## 1: Setup build trigger. 

You might want to build a new docker image each time something is committed to a certain branch. 

1. Go to [Google Cloud Console](http://console.google.com)
2. Go to *Container Registry*
3. Choose *Build Triggers*
4. Connect your GitHub account to Google Cloud
5. Select what your trigger should trigger on. 

Add some new commits to your branch and see how it triggers a build.
Notice that you can see your previous builds under *build history*.
 
 
## 2: Make username and password secrets
Having the username and password to your MySQL database in plain text directly in your code is not ideal.
We are now going to store them as secrets in Kubernetes and the connection URL as an environment variable.

### First we are going to insert the connection URL.
1. Open `AppConfig.java in the backend folder. Copy the database url.
2. Open [kubernetes-deployment/backend/deployment.yaml](../kubernetes-deployment/backend/deployment.yaml).
Insert these lines at the end of the `env` list, above `volumes`:
Make sure the indentation is the same as the lines above.
```
- name: DATABASE_URL
  value: "your copied url goes here"
```
3. Go back to `AppConfig.java` and set the url variable to use our newly created environment variable:
```
String url = System.getenv("DATABASE_URL");
```
4. If you want to run the backend locally now, you also have to create the environment variable on your machine by running this command in a terminal:
```
export DATABASE_URL="YOUR_URL"
```

### Create secrets and use them as environment variables
Now it is time to create our secret username and password.
1. To create a secret in kubernetes, you can type this command which uses base64 encryption.
Make sure to replace `YOUR_USERNAME` and `YOUR_PASSWORD` with your actual username and password.
```
kubectl create secret generic mysqlsecrets --from-literal=username=YOUR_USERNAME --from-literal=password=YOUR_PASSWORD
```
2. List the stored secrets in our cluster by typing the command `kubectl get secrets`.
You should see our newly created secret and another called something like `default-token`.
This is an access token generated by Kubernetes to authorize your pods.
3. Now that we have our secrets encrypted and safely stored, we can send them to our application.
Again we add environment variables to the list in [kubernetes-deployment/backend/deployment.yaml](../kubernetes-deployment/backend/deployment.yaml).
```
- name: MYSQL_USERNAME
  valueFrom:
    secretKeyRef:
      name: mysqlsecrets
      key: username
- name: MYSQL_PASSWORD
  valueFrom:
    secretKeyRef:
      name: mysqlsecrets
      key: password

```
4. With the secrets as encrypted environment variables, we can go ahead and use them in our `AppConfig.java`:
```
String username = System.getenv("MYSQL_USERNAME");
String password = System.getenv("MYSQL_PASSWORD");
```
5. Apply the changes to the backend pods by typing:
```
kubectl apply -f kubernetes-deployment/backend/deployment.yaml
```
 
## X.1: Add more information to your cluster 
Storage kanskje? Eller legge til spr√•k eller teknologier som ny database-tabell og vise denne frontend

## X. Add a favicon to your application. 
Find a nice icon to use as favicon and store it inside the public-folder.
Uncomment the line inside `index.html` so that the icon is added to the file.   